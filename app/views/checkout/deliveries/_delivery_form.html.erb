<%= form_with model: cart, url: deliveries_path, method: :post, local: true do |form| %>

  <div class="row">
    <div class="col-md-5">

      <%= render 'shared/form_errors', instance: cart %>
      <%= render 'shared/form_errors', instance: delivery_address %>
      <%= render 'shared/form_errors', instance: billing_address %>

      <% unless cart.tree_only? %>

        <div class="form-group">
          <%= form.text_field :recipient_message, class: "form-control mr-sm-2", placeholder: t('.recipient_message') %>
        </div>

      <% end %>

      <div class="form-group">
        <%= form.text_field :customer_note, class: "form-control mr-sm-2", placeholder: t('.customer_note') %>
      </div>


      <h4><%= t('.delivery_address') %></h4>

      <% if cart.email? %>

        <%= render 'email_address_form', string: "delivery_address", instance: delivery_address, form: form %>

      <% else %>

        <%= render 'postal_delivery_address_form', delivery_address: delivery_address, form: form %>

      <% end %>

      <h4><%= t('.billing_address') %></h4>


      <div data-controller="billing-address">

        <% if cart.postal? %>

          <div class="form-group">
            <%= form.check_box :delivery_is_billing, checked: true, data: { action: "billing-address#toggleDisplay", target: "billing-address.checkable" } %>
            <%= form.label t('.delivery_is_billing') %>
          </div>

        <% end %>

        <div data-target="billing-address.hideable" class="<%= "d-none" if cart.postal? %>">

          <%= render 'postal_billing_address_form', billing_address: billing_address, form: form %>

        </div>
      </div>
    </div>
    <div class="col-md-7">
      <div class="mb-2">

        <%= render 'line_items_table', cart: cart, form: form %>

      </div>

    <div class="d-flex flex-column align-items-end">

      <span class="d-flex flex-column align-items-end">
        <div class="font-weight-bold"><%= t('.total_price') %></div>
        <span><%= t('.without_delivery_fees') %></span>
        <div class="h4 orange font-weight-bold"><%= humanized_money_with_symbol @cart.ttc_price %></div>
        <% if @cart.coupon %>
          <div class="h6">- <%= humanized_money_with_symbol @cart.coupon_discount %> <%= t('.from_discount') %></div>
          <div class="h4 orange font-weight-bold"><%= humanized_money_with_symbol @cart.ttc_price_with_coupon %></div>
        <% end %>
      </span>

      <% unless @cart.coupon %>
        <%= render 'checkout/deliveries/add_coupon' %>
      <% end %>

      <div class="form-group">
        <%= form.check_box :general_sales_conditions, checked: false, required: true %>
        <%= form.label t('.general_sales_conditions') %>
      </div>

      <%= form.hidden_field :address_type, value: cart.delivery_method %>
      <%= hidden_field_tag :authenticity_token, form_authenticity_token %>

      <%= form.submit t('.go_to_payment'), class: "btn btn-orange"%>
    </div>
  </div>
<% end %>
